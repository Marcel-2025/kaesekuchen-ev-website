<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>K√§sekuchen.EV ‚Äì Guild Wars 2 Gilde</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #0b1020;
      --bg-soft: #121827;
      --bg-softer: #151b2f;
      --text: #f9fafb;
      --muted: #9ca3af;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.16);
      --border: rgba(148, 163, 184, 0.4);
      --danger: #f97373;
      --success: #4ade80;
    }

    [data-theme="light"] {
      --bg: #f3f4f6;
      --bg-soft: #ffffff;
      --bg-softer: #f9fafb;
      --text: #111827;
      --muted: #6b7280;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.12);
      --border: rgba(209, 213, 219, 1);
      --danger: #dc2626;
      --success: #16a34a;
    }

          /* Winter ‚Äì kalt, clean, icy blau */
      [data-theme="winter"] {
        --bg: #020617;
        --bg-soft: #02081f;
        --bg-softer: #081226;
        --text: #e5f2ff;
        --muted: #9ca3c7;
        --accent: #38bdf8;           /* Eisblau */
        --accent-soft: rgba(56, 189, 248, 0.16);
        --border: rgba(148, 163, 184, 0.5);
        --danger: #f97373;
        --success: #4ade80;
      }

      /* Halloween ‚Äì violett + orange, spooky */
      [data-theme="halloween"] {
        --bg: #050112;
        --bg-soft: #0b041f;
        --bg-softer: #140624;
        --text: #fde68a;
        --muted: #a78bfa;
        --accent: #f97316;           /* K√ºrbis-Orange */
        --accent-soft: rgba(249, 115, 22, 0.25);
        --border: rgba(168, 85, 247, 0.65);
        --danger: #fb7185;
        --success: #22c55e;
      }

      /* Fr√ºhling ‚Äì hell, frisch, gr√ºnlich/rosa */
      [data-theme="spring"] {
        --bg: #ecfeff;
        --bg-soft: #ffffff;
        --bg-softer: #fdf2ff;
        --text: #022c22;
        --muted: #6b7280;
        --accent: #22c55e;           /* Fr√ºhlingsgr√ºn */
        --accent-soft: rgba(34, 197, 94, 0.15);
        --border: rgba(148, 163, 184, 0.6);
        --danger: #dc2626;
        --success: #16a34a;
      }

      /* Herbst ‚Äì warm, orange, braun */
      [data-theme="autumn"] {
        --bg: #1f1308;
        --bg-soft: #25160a;
        --bg-softer: #2f1a0c;
        --text: #fef3c7;
        --muted: #fed7aa;
        --accent: #f97316;           /* Herbst-Orange */
        --accent-soft: rgba(249, 115, 22, 0.22);
        --border: rgba(248, 171, 94, 0.7);
        --danger: #f97373;
        --success: #22c55e;
      }

      /* Kleine Styles f√ºr Theme-Controls */
      .theme-controls {
        display: flex;
        align-items: center;
        gap: 0.4rem;
      }

      .theme-select {
        font-size: 0.75rem;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--bg-soft);
        color: var(--muted);
        padding: 0.25rem 0.6rem;
      }

      .accent-picker {
        width: 30px;
        height: 30px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: transparent;
        padding: 0;
        cursor: pointer;
      }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827, var(--bg));
      color: var(--text);
      min-height: 100vh;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(18px);
      background: linear-gradient(to bottom, rgba(15, 23, 42, 0.92), transparent);
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .nav {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0.8rem 1.4rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 20%, #facc15, var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }

    .logo-text span:first-child {
      font-weight: 700;
      letter-spacing: 0.08em;
      font-size: 0.9rem;
    }

    .logo-text span:last-child {
      font-size: 0.76rem;
      color: var(--muted);
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      font-size: 0.8rem;
      border: 1px solid transparent;
      background: none;
      color: var(--text);
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #facc15);
      color: #111827;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
    }

    .btn-outline {
      border-color: var(--border);
      background-color: rgba(15, 23, 42, 0.6);
      color: var(--muted);
    }

    [data-theme="light"] .btn-outline {
      background-color: #f9fafb;
    }

    .btn-icon {
      font-size: 1rem;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.8rem 1.4rem 2.5rem;
    }

    /* HERO */
    .hero {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.4fr);
      gap: 2rem;
      align-items: center;
      margin-bottom: 2.5rem;
    }

    @media (max-width: 900px) {
      .hero {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .hero-title {
      font-size: clamp(2.2rem, 3vw, 2.7rem);
      line-height: 1.05;
      margin: 0 0 0.9rem;
    }

    .hero-title span.highlight {
      background: linear-gradient(90deg, var(--accent), #facc15);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .hero-subtitle {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--muted);
      margin-bottom: 0.8rem;
      background-color: rgba(15, 23, 42, 0.8);
    }

    [data-theme="light"] .hero-subtitle {
      background-color: rgba(243, 244, 246, 0.9);
    }

    .hero-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #22c55e, #15803d);
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2);
    }

    .hero-desc {
      font-size: 0.95rem;
      color: var(--muted);
      max-width: 36rem;
      margin-bottom: 1rem;
    }

    .hero-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .hero-tag {
      font-size: 0.76rem;
      padding: 0.28rem 0.6rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background-color: var(--bg-soft);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      color: var(--muted);
    }

    [data-theme="light"] .hero-tag {
      background-color: #f9fafb;
    }

    .hero-card {
      border-radius: 16px;
      border: 1px solid var(--border);
      background:
        radial-gradient(circle at 0 0, var(--accent-soft), transparent 60%),
        var(--bg-soft);
      padding: 1.1rem 1rem 1rem;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.7);
    }

    .hero-card-header {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
    }

    .guild-name {
      font-weight: 700;
      font-size: 1.1rem;
      display: flex;
      align-items: baseline;
      gap: 0.4rem;
    }

    .guild-tag {
      font-size: 0.8rem;
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background-color: var(--bg-softer);
    }

    .guild-meta {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .hero-stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.6rem;
      margin-bottom: 0.6rem;
    }

    .stat-pill {
      border-radius: 12px;
      border: 1px solid var(--border);
      background-color: var(--bg-softer);
      padding: 0.45rem 0.6rem;
      font-size: 0.78rem;
    }

    .stat-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.65rem;
      color: var(--muted);
    }

    .stat-value {
      font-weight: 600;
      margin-top: 0.15rem;
    }

    .motd-box {
      margin-top: 0.4rem;
      border-radius: 10px;
      border: 1px dashed var(--border);
      padding: 0.6rem 0.7rem;
      font-size: 0.8rem;
      color: var(--muted);
      max-height: 120px;
      overflow-y: auto;
      background-color: var(--bg-softer);
    }

    .motd-label {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.64rem;
      margin-bottom: 0.2rem;
      color: var(--muted);
    }

    /* SECTIONS */
    section {
      margin-bottom: 2.4rem;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      gap: 0.8rem;
      align-items: baseline;
      margin-bottom: 0.9rem;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .section-subtitle {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .card {
      border-radius: 16px;
      border: 1px solid var(--border);
      background-color: var(--bg-soft);
      padding: 1rem 1rem;
    }

    .table-wrapper {
      border-radius: 16px;
      border: 1px solid var(--border);
      background-color: var(--bg-soft);
      overflow: hidden;
    }

    .table-header {
      padding: 0.6rem 0.9rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .table-header-right {
      display: flex;
      gap: 0.6rem;
      align-items: center;
    }

    .pill-counter {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.75rem;
      color: var(--muted);
      background-color: var(--bg-softer);
    }

    .status-pill {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.75rem;
      color: var(--muted);
      background-color: var(--bg-softer);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    thead {
      background-color: rgba(15, 23, 42, 0.9);
    }

    th, td {
      padding: 0.55rem 0.9rem;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }

    tbody tr:nth-child(2n) {
      background-color: rgba(15, 23, 42, 0.4);
    }

    .rank-pill {
      padding: 0.18rem 0.5rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      display: inline-flex;
      align-items: center;
      font-size: 0.72rem;
    }

    .rank-pill.leader {
      border-color: #facc15;
      color: #facc15;
    }

    .leaderboard-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.4rem 0;
      border-bottom: 1px dashed rgba(148, 163, 184, 0.4);
      font-size: 0.85rem;
    }

    .characters-list {
      list-style: none;
      padding: 0;
      margin: 0.4rem 0 0;
      font-size: 0.85rem;
    }

    .characters-list li {
      padding: 0.3rem 0;
      border-bottom: 1px dashed rgba(148, 163, 184, 0.35);
      cursor: pointer;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.7rem;
      margin-bottom: 0.8rem;
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      font-size: 0.8rem;
    }

    .form-field input,
    .form-field textarea {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 0.45rem 0.55rem;
      background-color: var(--bg-softer);
      color: var(--text);
      font-size: 0.85rem;
    }

    footer {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 1.4rem 1.5rem;
      font-size: 0.75rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="logo">
        <div class="logo-icon">üßÄ</div>
        <div class="logo-text">
          <span>K√ÑSEKUCHEN.EV</span>
          <span>Guild Wars 2 Gilde</span>
        </div>
      </div>
      <div class="nav-right">
  <a href="https://discord.gg/QKzbUV2wab" target="_blank" class="btn btn-primary">
    üí¨ Discord
  </a>
  <div class="theme-controls">
    <select id="theme-select" class="theme-select">
      <option value="dark">Standard Dark</option>
      <option value="light">Standard Light</option>
      <option value="winter">‚ùÑÔ∏è Winter</option>
      <option value="halloween">üéÉ Halloween</option>
      <option value="spring">üå∏ Fr√ºhling</option>
      <option value="autumn">üçÇ Herbst</option>
    </select>
    <input type="color" id="accent-picker" class="accent-picker" title="Akzentfarbe anpassen" />
  </div>
</div>


    </div>
  </header>

  <main>

    <!-- HERO -->
    <section class="hero">
      <div>
        <div class="hero-subtitle">
          <div class="hero-dot"></div>
          <span>Aktive Community</span>
        </div>
        <h1 class="hero-title">
          <span class="highlight">K√§sekuchen.EV</span><br />
          Die gem√ºtlichste Gilde in Tyria.
        </h1>
        <p class="hero-desc">Raids, Fraktale, WvW, entspannte Runs und geile Leute. üç∞üî•</p>

        <div class="hero-tags">
          <span class="hero-tag">üí¨ Discord Community</span>
          <span class="hero-tag">üõ°Ô∏è Raids & Strikes</span>
          <span class="hero-tag">üåç EU / Deutsch</span>
          <span class="hero-tag">üòÑ Casual & Progress</span>
        </div>

        <div style="display:flex;gap:0.6rem;">
          <a href="#members" class="btn btn-primary">üìú Mitglieder</a>
          <a href="#apply" class="btn btn-outline">Bewerbung</a>
        </div>
      </div>

      <div class="hero-card">
        <div class="hero-card-header">
          <div>
            <div class="guild-name">
              <span id="guild-name">K√§sekuchen Ev</span>
              <span class="guild-tag" id="guild-tag">[KKev]</span>
            </div>
            <div class="guild-meta" id="guild-meta">Wird geladen‚Ä¶</div>
          </div>
        </div>

        <div class="hero-stats">
          <div class="stat-pill">
            <div class="stat-label">Mitglieder</div>
            <div class="stat-value" id="stat-members">‚Äì</div>
          </div>
          <div class="stat-pill">
            <div class="stat-label">Level</div>
            <div class="stat-value" id="stat-level">‚Äì</div>
          </div>
          <div class="stat-pill">
            <div class="stat-label">Server</div>
            <div class="stat-value" id="stat-world">‚Äì</div>
          </div>
        </div>

        <div class="motd-box">
          <div class="motd-label">MOTD</div>
          <div id="motd-text">Lade‚Ä¶</div>
        </div>
      </div>
    </section>

    <!-- MEMBERS + LEADERBOARD -->
    <section id="members">
      <div class="section-header">
        <div>
          <div class="section-title">Mitgliederliste</div>
          <div class="section-subtitle">Direkt aus der GW2 API</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns: minmax(0,3fr) minmax(0,2fr);gap:1rem;">
        <!-- TABELLE -->
        <div class="table-wrapper">
          <div class="table-header">
            <span>Mitglieder</span>
            <div class="table-header-right">
              <span class="pill-counter"><span id="member-count-label">0</span> Mitglieder</span>
              <span class="status-pill" id="members-status-pill">Lade‚Ä¶</span>
            </div>
          </div>

          <div style="max-height:320px;overflow:auto;">
            <table>
              <thead>
                <tr>
                  <th>Account</th>
                  <th>Rang</th>
                  <th>Beigetreten</th>
                </tr>
              </thead>
              <tbody id="members-body"></tbody>
            </table>
          </div>
        </div>

        <!-- LEADERBOARD -->
        <div class="card">
          <div class="section-header" style="margin-bottom:0.4rem;">
            <div class="section-title" style="font-size:1rem;">Leaderboard</div>
          </div>
          <ul class="leaderboard-list" id="leaderboard-list"></ul>
        </div>
      </div>
    </section>

    <!-- GUILD HALL + LOG + TREASURY -->
    <section id="guild-extra">
      <div class="section-header">
        <div>
          <div class="section-title">Gildenhalle & Logbuch</div>
          <div class="section-subtitle">√úbersicht √ºber Upgrades & letzte Aktionen</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:minmax(0,2fr) minmax(0,3fr);gap:1rem;">

        <!-- Gildenhalle -->
        <div class="card">
          <div class="section-header" style="margin-bottom:0.4rem;">
            <div class="section-title" style="font-size:1rem;">Gildenhalle</div>
          </div>

          <p><strong>Halle:</strong> <span id="hall-name">‚Äì</span></p>
          <p><strong>Level:</strong> <span id="hall-level">‚Äì</span></p>
          <p><strong>Upgrades:</strong> <span id="hall-upgrades-count">‚Äì</span></p>

          <p class="status-text" id="hall-status-text">Lade‚Ä¶</p>
        </div>

        <!-- Log + Treasury -->
        <div class="card">
          <div class="section-header" style="margin-bottom:0.4rem;">
            <div class="section-title" style="font-size:1rem;">Aktivit√§tslog</div>
          </div>

          <div style="max-height:160px;overflow:auto;border:1px solid var(--border);border-radius:8px;padding:0.5rem;background-color:var(--bg-softer);">
            <ul id="guild-log-list" style="list-style:none;padding:0;margin:0;font-size:0.8rem;"></ul>
          </div>

          <p class="status-text" id="guild-log-status">Lade Log‚Ä¶</p>

          <div style="max-height:140px;overflow:auto;border:1px solid var(--border);border-radius:8px;padding:0.5rem;margin-top:0.6rem;background-color:var(--bg-softer);">
            <table style="width:100%;font-size:0.75rem;">
              <thead>
                <tr>
                  <th>Item</th>
                  <th style="text-align:right;">Hat</th>
                  <th style="text-align:right;">Braucht</th>
                </tr>
              </thead>
              <tbody id="treasury-body"></tbody>
            </table>
          </div>

          <p class="status-text" id="treasury-status">Lade Treasury‚Ä¶</p>
        </div>
      </div>
    </section>

    <!-- ACCOUNTS / CHARACTERS -->
    <section id="accounts-section">
      <div class="section-header">
        <div>
          <div class="section-title">Charaktere nach Account</div>
          <div class="section-subtitle">Basierend auf deinen API Keys</div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;gap:0.6rem;align-items:center;flex-wrap:wrap;margin-bottom:0.8rem;">
          <select id="account-select" class="select">
            <option>Accounts laden‚Ä¶</option>
          </select>

          <button class="btn btn-outline" id="load-chars-btn">üßô Charaktere anzeigen</button>
          <span class="status-pill" id="accounts-status-pill">Lade‚Ä¶</span>
        </div>

        <ul class="characters-list" id="characters-list"></ul>
        <p class="status-text" id="accounts-status-text"></p>
      </div>
    </section>

    <!-- APPLICATION FORM -->
    <section id="apply">
      <div class="section-header">
        <div>
          <div class="section-title">Gildenbewerbung</div>
        </div>
      </div>

      <div class="card">
        <form id="apply-form">
          <div class="form-grid">
            <div class="form-field">
              <label>Name</label>
              <input type="text" id="apply-name" required />
            </div>
            <div class="form-field">
              <label>Accountname</label>
              <input type="text" id="apply-account" required />
            </div>
            <div class="form-field">
              <label>Spielzeiten</label>
              <input type="text" id="apply-time" />
            </div>
            <div class="form-field">
              <label>Erfahrung</label>
              <input type="text" id="apply-experience" />
            </div>
          </div>

          <div class="form-field">
            <label>Warum m√∂chtest du beitreten?</label>
            <textarea id="apply-message" rows="4" required></textarea>
          </div>

          <button class="btn btn-primary" type="submit">üì© Bewerbung erzeugen</button>

          <div id="apply-feedback"></div>

          <div class="form-field" style="margin-top:0.8rem;">
            <label>Erzeugter Text</label>
            <textarea id="apply-output" rows="5" readonly></textarea>
          </div>
        </form>
      </div>
    </section>

  </main>

  <footer>
    <div>‚ù§Ô∏è K√§sekuchen.EV ‚Äì Powered by Guild Wars 2 API</div>
    <div>API Docs: <a href="https://wiki.guildwars2.com/wiki/API:2" target="_blank">GW2 Wiki</a></div>
  </footer>

  <script>
    /* --------------- THEME --------------- */
    const THEME_KEY = "kkev-theme";
    const ACCENT_KEY = "kkev-accent";

    function applyTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
      const select = document.getElementById("theme-select");
      if (select && select.value !== theme) {
        select.value = theme;
      }
    }

    function applyAccentColor(color) {
      if (!color) return;
      document.documentElement.style.setProperty("--accent", color);
      document.documentElement.style.setProperty("--accent-soft", `${color}33`); // leichte Transparenz
      localStorage.setItem(ACCENT_KEY, color);
    }

    // Initial Theme/Accent laden
    (function initTheme() {
      const savedTheme = localStorage.getItem(THEME_KEY) || "dark";
      applyTheme(savedTheme);

      const savedAccent = localStorage.getItem(ACCENT_KEY);
      if (savedAccent) {
        applyAccentColor(savedAccent);
      }
    })();

    function formatDate(iso) {
      if (!iso) return "‚Äì";
      const d = new Date(iso);
      if (isNaN(d)) return "‚Äì";
      return d.toLocaleDateString("de-DE");
    }

    /* ---------------- GUILD INFO ---------------- */
    async function loadGuildInfo() {
      const nameEl = document.getElementById("guild-name");
      const tagEl = document.getElementById("guild-tag");
      const metaEl = document.getElementById("guild-meta");
      const motdEl = document.getElementById("motd-text");
      const statMembers = document.getElementById("stat-members");
      const statLevel = document.getElementById("stat-level");
      const statWorld = document.getElementById("stat-world");

      try {
        const res = await fetch("/api/guild-info");
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();

        nameEl.textContent = data.name || "K√§sekuchen Ev";
        tagEl.textContent = data.tag ? `[${data.tag}]` : "[KKev]";
        metaEl.textContent = `Level ${data.level} ‚Ä¢ ${data.member_count} Mitglieder`;

        statMembers.textContent = data.member_count;
        statLevel.textContent = data.level;
        statWorld.textContent = data.world;

        motdEl.textContent = data.motd || "Keine MOTD gesetzt.";
      } catch (err) {
        metaEl.textContent = "Fehler beim Laden";
        motdEl.textContent = "Fehler: " + err.message;
      }
    }

    /* ---------------- MEMBERS ---------------- */
    let guildMembers = [];

    async function loadGuildMembers() {
      const body = document.getElementById("members-body");
      const counter = document.getElementById("member-count-label");
      const pill = document.getElementById("members-status-pill");

      body.innerHTML = "";

      try {
        const res = await fetch("/api/guild-members");
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();
        const members = data.members || [];
        guildMembers = members;

        counter.textContent = members.length;

        members.sort((a, b) => (a.name || "").localeCompare(b.name || ""));

        members.forEach(m => {
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${m.name}</td>
            <td><span class="rank-pill ${m.rank.toLowerCase().includes("leader") ? "leader" : ""}">${m.rank}</span></td>
            <td>${formatDate(m.joined)}</td>
          `;

          body.appendChild(tr);
        });

        pill.textContent = "Geladen";
      } catch (err) {
        pill.textContent = "Fehler";
      }

      buildLeaderboard();
    }

    function buildLeaderboard() {
      const list = document.getElementById("leaderboard-list");
      list.innerHTML = "";

      if (!guildMembers.length) return;

      const sorted = [...guildMembers].sort((a, b) => {
        const rankValue = r => r.toLowerCase().includes("leader") ? 0 :
                               r.toLowerCase().includes("offi") ? 1 : 2;
        return rankValue(a.rank) - rankValue(b.rank);
      });

      sorted.slice(0, 5).forEach((m, i) => {
        const li = document.createElement("li");
        li.className = "leaderboard-item";
        li.innerHTML = `
          <div>${i + 1}. ${m.name}</div>
          <div>${m.rank}</div>
        `;
        list.appendChild(li);
      });
    }

    /* ---------------- GUILD HALL ---------------- */
    async function loadGuildHall() {
      const hallName = document.getElementById("hall-name");
      const hallLevel = document.getElementById("hall-level");
      const hallUp = document.getElementById("hall-upgrades-count");
      const status = document.getElementById("hall-status-text");

      try {
        const res = await fetch("/api/guild-hall");
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();

        hallName.textContent = data.hall || "‚Äì";
        hallLevel.textContent = data.level || "‚Äì";
        hallUp.textContent = data.upgrades ? data.upgrades.length : "‚Äì";

        status.textContent = "Geladen";
      } catch (err) {
        status.textContent = "Fehler: " + err.message;
      }
    }

    /* ---------------- GUILD LOG ---------------- */
    function formatLog(entry) {
      const t = entry.time ? new Date(entry.time).toLocaleString("de-DE") : "";
      if (entry.type === "joined") return `${t} ‚Äì ${entry.user} ist beigetreten`;
      if (entry.type === "kick") return `${t} ‚Äì ${entry.user} wurde entfernt`;
      if (entry.type === "invited") return `${t} ‚Äì ${entry.user} wurde eingeladen`;
      if (entry.type === "rank_change") return `${t} ‚Äì ${entry.user} wurde bef√∂rdert`;
      if (entry.type === "motd") return `${t} ‚Äì MOTD ge√§ndert`;
      return `${t} ‚Äì ${entry.type}`;
    }

    async function loadGuildLog() {
      const list = document.getElementById("guild-log-list");
      const status = document.getElementById("guild-log-status");
      list.innerHTML = "";

      try {
        const res = await fetch("/api/guild-log");
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();

        data.log.forEach(e => {
          const li = document.createElement("li");
          li.textContent = formatLog(e);
          list.appendChild(li);
        });

        status.textContent = "Geladen";
      } catch (err) {
        status.textContent = "Fehler: " + err.message;
      }
    }

    /* ---------------- TREASURY ---------------- */
    async function loadGuildTreasury() {
      const tbody = document.getElementById("treasury-body");
      const status = document.getElementById("treasury-status");
      tbody.innerHTML = "";

      try {
        const res = await fetch("/api/guild-treasury");
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();
        const items = data.treasury || [];

        items.slice(0, 20).forEach(t => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${t.item_id}</td>
            <td style="text-align:right">${t.count}</td>
            <td style="text-align:right">${t.required}</td>
          `;
          tbody.appendChild(tr);
        });

        status.textContent = "Geladen";
      } catch (err) {
        status.textContent = "Fehler: " + err.message;
      }
    }

    /* ---------------- ACCOUNTS / CHARS ---------------- */
    async function loadAccounts() {
      const select = document.getElementById("account-select");
      const pill = document.getElementById("accounts-status-pill");

      try {
        const res = await fetch("/api/accounts");
        if (!res.ok) throw new Error("HTTP " + res.status);

        const accounts = await res.json();
        select.innerHTML = "";

        accounts.forEach(a => {
          const opt = document.createElement("option");
          opt.value = a.id;
          opt.textContent = `${a.name} (Welt ${a.world})`;
          select.appendChild(opt);
        });

        pill.textContent = "Geladen";
      } catch (err) {
        pill.textContent = "Fehler";
      }
    }

    async function loadCharacters() {
      const select = document.getElementById("account-select");
      const list = document.getElementById("characters-list");
      const status = document.getElementById("accounts-status-text");

      const id = select.value;
      if (!id) return;

      list.innerHTML = "";
      status.textContent = "Lade‚Ä¶";

      try {
        const res = await fetch(`/api/accounts/${id}/characters`);
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();
        data.characters.forEach(c => {
          const li = document.createElement("li");
          li.textContent = c;
          li.onclick = () => loadCharDetail(id, c);
          list.appendChild(li);
        });

        status.textContent = "Fertig";
      } catch (err) {
        status.textContent = "Fehler: " + err.message;
      }
    }

    async function loadCharDetail(accId, charName) {
      const status = document.getElementById("accounts-status-text");
      status.textContent = `Lade Details f√ºr ${charName}‚Ä¶`;

      try {
        const res = await fetch(`/api/accounts/${accId}/characters/${charName}`);
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();
        const c = data.character;

        const list = document.getElementById("characters-list");
        const detail = document.createElement("li");
        detail.style.color = "var(--muted)";
        detail.innerHTML = `
          <strong>${c.name}</strong><br>
          Level ${c.level} ${c.race} ${c.profession}<br>
          Tode: ${c.deaths}<br>
          Erstellt: ${formatDate(c.created)}
        `;

        list.appendChild(detail);
        status.textContent = "Details geladen";
      } catch (err) {
        status.textContent = "Fehler: " + err.message;
      }
    }

    document.getElementById("load-chars-btn").onclick = loadCharacters;

    /* ---------------- APPLICATION FORM ---------------- */
    document.getElementById("apply-form").addEventListener("submit", e => {
      e.preventDefault();

      const name = document.getElementById("apply-name").value;
      const account = document.getElementById("apply-account").value;
      const time = document.getElementById("apply-time").value;
      const exp = document.getElementById("apply-experience").value;
      const msg = document.getElementById("apply-message").value;

      const out = document.getElementById("apply-output");

      out.value = `
Hey K√§sekuchen.EV,

ich bin ${name} (${account}).

Spielzeiten: ${time || "-"}
Erfahrung: ${exp || "-"}

Warum ich zu euch m√∂chte:
${msg}

Liebe Gr√º√üe,
${name}
      `.trim();
    });

    /* ---------------- INIT ---------------- */
document.addEventListener("DOMContentLoaded", () => {
  loadGuildInfo();
  loadGuildMembers();
  loadGuildHall();
  loadGuildLog();
  loadGuildTreasury();
  loadAccounts();

  // Theme-Controls
  const themeSelect = document.getElementById("theme-select");
  const accentPicker = document.getElementById("accent-picker");

  if (themeSelect) {
    // initial Wert setzen (falls localStorage schon was hat)
    const savedTheme = localStorage.getItem(THEME_KEY) || "dark";
    themeSelect.value = savedTheme;

    themeSelect.addEventListener("change", () => {
      const t = themeSelect.value;
      localStorage.setItem(THEME_KEY, t);
      applyTheme(t);
    });
  }

  if (accentPicker) {
    const savedAccent = localStorage.getItem(ACCENT_KEY);
    if (savedAccent) {
      accentPicker.value = savedAccent;
    } else {
      // fallback: aktuelle Accent-Farbe aus CSS holen
      const cs = getComputedStyle(document.documentElement);
      const accent = cs.getPropertyValue("--accent").trim() || "#f97316";
      accentPicker.value = accent;
    }

    accentPicker.addEventListener("input", () => {
      applyAccentColor(accentPicker.value);
    });
  }
});
  </script>
</body>
</html>
